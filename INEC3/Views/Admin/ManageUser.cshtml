@model INEC3.Models.UserDisplay
@{
    ViewBag.Title = "ManageUser";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
@Scripts.Render("~/bundles/jquery")
<!-- Select CSS -->
<link href="@Url.Content("/Content/plugins/bower_components/bootstrap-select/bootstrap-select.min.css")" rel="stylesheet" />
<style>
    input, select, textarea {
        max-width: 480px;
    }
</style>

<div class="container-fluid">
    <div class="row bg-title">
        <div class="col-lg-3 col-md-4 col-sm-4 col-xs-12">
            <h4 class="page-title">Manage User</h4>
        </div>
        <div class="col-lg-9 col-sm-8 col-md-8 col-xs-12">
            <a href="@Url.Action("Users")" class="btn btn-danger pull-right m-l-20  waves-effect waves-light">User List</a>
            <ol class="breadcrumb">
                <li>User</li>
                <li class="active">Manage</li>
            </ol>
        </div>
        <!-- /.col-lg-12 -->
    </div>
    <div class="row">
        <div class="col-sm-12">
            <div class="white-box">
                <p></p>
                <div class="row">
                    <div class="col-sm-12 col-xs-12">
                        @Html.AntiForgeryToken()

                        <div class="row">
                            <div class="col-md-12">
                                @Html.HiddenFor(model => model.UserId, new { @id = "UserId" })

                                <div class="form-group col-md-6">
                                    @Html.Label("Role")
                                    @Html.DropDownList("Role", new SelectList(ViewBag.Roles, "Value", "Text", @Model.Role), htmlAttributes: new { @class = "form-control", @onchange = "RoleChange()", @required = true })
                                </div>

                                <div class="form-group col-md-6" id="Province" style="display:none;">
                                    @Html.Label("Province")
                                    @Html.DropDownList("ID_Province", new SelectList(ViewBag.Province, "Value", "Text"), htmlAttributes: new { @class = "form-control", @onchange = "GetTerritoireList()", @required = true })
                                </div>
                                <div class="form-group col-md-6" id="Territoire" style="display:none;">
                                    @Html.Label("Territoire")
                                    @Html.DropDownList("ID_Territoire", new SelectList(ViewBag.Territoire, "Value", "Text"), htmlAttributes: new { @class = "form-control disable", @onchange = "GetCommune()", @required = true })
                                </div>

                                <div class="form-group col-md-6" id="Commune" style="display:none;">
                                    @Html.Label("Commune")
                                    @Html.DropDownList("ID_Commune", new SelectList(ViewBag.Commune, "Value", "Text"), htmlAttributes: new { @class = "form-control", @onchange = "GetPoolingStation()", @required = true })

                                </div>
                                <div class="form-group col-md-6" id="PollingStation" style="display:none;">
                                    @Html.Label("Poling Station")
                                    @Html.DropDownList("ID_Bureauvote", new SelectList(ViewBag.Polingstation, "Value", "Text"), htmlAttributes: new { @class = "form-control", @required = true })
                                    @*<select id="ID_Bureauvote" name="ID_Bureauvote" class="form-control selectpicker" multiple data-style="form-control"></select>*@
                                </div>
                            </div>
                            <div class="col-sm-12 col-xs-12">
                                <button type="button" id="brnsave" class="btn btn-primary pull-right">Save</button>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!--Multiselect JavaScript -->
    <script src="@Url.Content("/Content/plugins/bower_components/bootstrap-select/bootstrap-select.min.js")" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {
            $(".preloader").fadeOut();
            RoleChange();
            $("#Role option:contains('SuperAdmin')").remove();
            $('#brnsave').on('click', function () { SaveRole() });
        });
        function GetTerritoireList() {
            if ($('#ID_Province').val() > 0) {
                $(".preloader").show();
                $('#ID_Territoire').html('');
                $('#ID_Territoire').append($('<option></option>').val('').html('Select Territoire'));
                $.ajax({
                    url: '/api/Results/GetTerritoireList',
                    type: 'GET',
                    headers: { Authorization: bearer },
                    data: { ProvinceId: $('#ID_Province').val() },
                    success: function (res) {
                        if (res) {
                            $.each(res, function (i, v) {
                                $('#ID_Territoire').append($('<option></option>').val(v.ID_Territoire).html(v.Nom));
                            });
                        }
                    }
                });
                $(".preloader").fadeOut();
            }
        }
        function GetCommune() {
            if ($('#ID_Territoire').val() > 0) {
                $(".preloader").show();
                $('#ID_Commune').html('');
                //$('#ID_Commune').append($('<option></option>').val('').html('Select Commune'));
                $.ajax({
                    url: '/api/Results/GetCommune',
                    type: 'GET',
                    headers: { Authorization: bearer },
                    data: { ProvinceId: $('#ID_Province').val(), TerritoireId: $('#ID_Territoire').val() },
                    success: function (res) {
                        //console.log(res);
                        if (res) {
                            $.each(res, function (i, v) {
                                $('#ID_Commune').append($('<option></option>').val(v.ID_Commune).html(v.Nom));
                            });
                        }
                        $(".preloader").fadeOut();
                    },
                    error: function (err) {
                        $(".preloader").fadeOut();
                    }
                });
            }

        }
        function GetPoolingStation() {
            if ($('#ID_Commune').val() > 0) {
                $(".preloader").show();
                $('#ID_Bureauvote').html('');
                $('#ID_Bureauvote').append($('<option></option>').val('').html('Select Pooling Station'));
                $.ajax({
                    url: '/api/Results/GetPoolingStationList',
                    type: 'GET',
                    headers: { Authorization: bearer },
                    data: { CommuneId: $('#ID_Commune').val() },
                    success: function (res) {
                        if (res) {
                            $.each(res, function (i, v) {
                                $('#ID_Bureauvote').append($('<option></option>').val(v.ID_Bureauvote).html(v.Nom));
                            });
                            $('#ID_Bureauvote').selectpicker('refresh');
                        }
                        $(".preloader").fadeOut();
                    },
                    error: function (err) {
                        $(".preloader").fadeOut();
                    }
                });
            }
        }
        function RoleChange() {
            var select = $("#Role option:selected").text();
            if (select == "Province") {
                $("#Province").show()
                $("#Territoire").hide()
                $("#Commune").hide()
                $("#PollingStation").hide()
            }
            else if (select == "Territoire") {
                $("#Province").hide()
                $("#Territoire").show()
                $("#Commune").hide()
                $("#PollingStation").hide()
            }
            else if (select == "Commune") {
                $('#Province').hide()
                $('#Territoire').hide()
                $('#Commune').show()
                $('#PollingStation').hide()
            }
            else if (select == "PollingStation") {
                $('#Province').hide()
                $('#Territoire').hide()
                $('#Commune').hide()
                $('#PollingStation').show()
            }
        }
        function SaveRole() {
            $(".preloader").show();

            var data = {
                UserID: $('#UserId').val(),
                AssignRole: $("#Role option:selected").text(),
                AssignID: 0
            };
            
            if (data.AssignRole == "Province") { data.AssignID = $('#ID_Province').val(); }
            else if (data.AssignRole == "Territoire") { data.AssignID = $('#ID_Territoire').val(); }
            else if (data.AssignRole == "Commune") { data.AssignID = $('#ID_Commune').val(); }
            else if (data.AssignRole == "PollingStation") { data.AssignID = $('#ID_Bureauvote').val(); }
            if (data.AssignID != "" || data.AssignRole != "" || data.AssignID != "" && data.AssignRole != "") {
                $.ajax({
                    url: '/Admin/UserPolStation',
                    type: 'POST',
                    //headers: { Authorization: bearer },
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(data),
                    success: function (res) {
                        if (res) {
                            alert(res);
                        }
                        $(".preloader").fadeOut();
                    },
                    error: function (err) {
                        alert(err);
                        $(".preloader").fadeOut();
                    }
                });
            }
            else {
                alert('Please Select Value');
            }
        }
    </script>
}